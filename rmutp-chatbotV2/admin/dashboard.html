<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RMUTP Chatbot Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            background: #f5f7fa;
        }
        
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #940032 0%, #6b0024 100%);
            color: white;
            padding: 20px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 30px;
        }
        
        .sidebar-header h2 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 13px;
            opacity: 0.8;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: rgba(255,255,255,0.15);
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
        }
        
        .logout-btn {
            margin-top: 50px;
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .topbar h1 {
            font-size: 28px;
            color: #333;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #940032, #C41E3A);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-change {
            font-size: 13px;
            margin-top: 8px;
        }
        
        .stat-change.positive {
            color: #10b981;
        }
        
        /* Content Section */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 24px;
            color: #333;
        }
        
        .btn-primary {
            padding: 10px 20px;
            background: linear-gradient(135deg, #940032, #C41E3A);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(148, 0, 50, 0.3);
        }
        
        /* Table */
        .data-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #f8f9fa;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        td {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            color: #666;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-inactive {
            background: #fee;
            color: #c33;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .action-btns {
            display: flex;
            gap: 8px;
        }
        
        .btn-edit,
        .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-edit {
            background: #3b82f6;
            color: white;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .search-filter {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .page-btn.active {
            background: #940032;
            color: white;
            border-color: #940032;
        }
        
        .page-info {
            color: #666;
            font-size: 14px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #940032;
        }
        
        .close-modal {
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            line-height: 1;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .form-group {
            margin: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group textarea {
            resize: vertical;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-secondary:hover {
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>RMUTP Admin</h2>
                <p>Chatbot Management</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-section="dashboard">
                        <span class="nav-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="faqs">
                        <span class="nav-icon">üí¨</span>
                        <span>FAQ Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="chatlogs">
                        <span class="nav-icon">üìù</span>
                        <span>Chat Logs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="news">
                        <span class="nav-icon">üì∞</span>
                        <span>News Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-section="staff">
                        <span class="nav-icon">üë•</span>
                        <span>Staff Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="analytics.html" class="nav-link" target="_blank">
                        <span class="nav-icon">üìä</span>
                        <span>Analytics Dashboard</span>
                    </a>
                </li>
            </ul>
            
            <button class="logout-btn" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="topbar">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div>
                        <div style="font-weight: 600;">Admin</div>
                        <div style="font-size: 13px; color: #666;">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <!-- Quick Access Section -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; margin-bottom: 25px; color: white;">
                    <h2 style="font-size: 20px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span>üöÄ</span>
                        <span>Quick Access</span>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <a href="analytics.html" target="_blank" style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)';">
                            <div style="font-size: 32px;">üìä</div>
                            <div style="font-weight: 600; font-size: 16px;">Analytics Dashboard</div>
                            <div style="font-size: 13px; opacity: 0.9;">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏∞‡∏ö‡∏ö</div>
                        </a>
                        <a href="#" onclick="checkFeedbackStats(); return false;" style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)';">
                            <div style="font-size: 32px;">üëç</div>
                            <div style="font-weight: 600; font-size: 16px;">Feedback Stats</div>
                            <div style="font-size: 13px; opacity: 0.9;" id="feedbackQuickStats">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                        </a>
                        <a href="#" onclick="checkAIStatus(); return false;" style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)';">
                            <div style="font-size: 32px;">ü§ñ</div>
                            <div style="font-weight: 600; font-size: 16px;">AI Server Status</div>
                            <div style="font-size: 13px; opacity: 0.9;" id="aiServerStatus">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
                        </a>
                        <a href="../frontend/index.html" target="_blank" style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; text-decoration: none; color: white; transition: all 0.3s; display: flex; flex-direction: column; gap: 8px; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)';">
                            <div style="font-size: 32px;">üí¨</div>
                            <div style="font-weight: 600; font-size: 16px;">Test Chatbot</div>
                            <div style="font-size: 13px; opacity: 0.9;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Chatbot</div>
                        </a>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total FAQs</span>
                            <div class="stat-icon" style="background: #dbeafe; color: #1e40af;">üí¨</div>
                        </div>
                        <div class="stat-value" id="totalFaqs">-</div>
                        <div class="stat-change" style="color: #6b7280;">622 FAQs ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total Conversations</span>
                            <div class="stat-icon" style="background: #d1fae5; color: #065f46;">üìù</div>
                        </div>
                        <div class="stat-value" id="totalChats">-</div>
                        <div class="stat-change" id="totalChatsLabel">‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Today's Chats</span>
                            <div class="stat-icon" style="background: #fef3c7; color: #92400e;">üë•</div>
                        </div>
                        <div class="stat-value" id="activeSessions">-</div>
                        <div class="stat-change" style="color: #6b7280;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Avg Confidence</span>
                            <div class="stat-icon" style="background: #fce7f3; color: #9f1239;">‚ö°</div>
                        </div>
                        <div class="stat-value" id="avgResponse">-</div>
                        <div class="stat-change" style="color: #6b7280;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                    </div>
                </div>
                
                <div class="section-header">
                    <h2 class="section-title">Recent Chat Logs</h2>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th>
                                <th>Confidence</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody id="recentChats">
                            <tr>
                                <td colspan="4" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- FAQ Management Section -->
            <section id="faqs" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">FAQ Management</h2>
                    <button class="btn-primary" onclick="openCreateFAQModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° FAQ ‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                
                <div class="search-filter">
                    <input type="text" class="search-input" id="faqSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...">
                    <select class="filter-select" id="categoryFilter">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                    </select>
                    <button class="btn-primary" onclick="loadFAQs()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</th>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="faqList">
                            <tr>
                                <td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="faqPagination"></div>
            </section>
            
            <!-- Chat Logs Section -->
            <section id="chatlogs" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Chat Logs</h2>
                    <button class="btn-primary" onclick="exportChatLogsCSV()">üì• Export CSV</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Session ID</th>
                                <th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</th>
                                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th>Confidence</th>
                                <th>Response Time</th>
                            </tr>
                        </thead>
                        <tbody id="chatLogsList">
                            <tr>
                                <td colspan="5" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- News Section -->
            <section id="news" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">News Management</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-primary" onclick="openCreateNewsModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà</button>
                        <button class="btn-primary" onclick="scrapeNews()">üîÑ Scrape Now</button>
                    </div>
                </div>
                
                <div class="search-filter">
                    <input type="text" class="search-input" id="newsSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß...">
                    <select class="filter-select" id="newsCategoryFilter">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                        <option value="‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        <option value="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                    </select>
                    <button class="btn-primary" onclick="loadNews()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</th>
                                <th>Views</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="newsList">
                            <tr>
                                <td colspan="7" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="newsPagination"></div>
            </section>
            
            <!-- Staff Section -->
            <section id="staff" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Staff Management</h2>
                </div>
                
                <div class="search-filter">
                    <input type="text" class="search-input" id="staffSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠...">
                    <select class="filter-select" id="departmentFilter">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</option>
                    </select>
                    <button class="btn-primary" onclick="loadStaff()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</th>
                                <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                                <th>‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="staffList">
                            <tr>
                                <td colspan="7" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination" id="staffPagination"></div>
            </section>
        </main>
    </div>
    
    <!-- FAQ Modal -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏° FAQ ‡πÉ‡∏´‡∏°‡πà</h3>
                <span class="close-modal" onclick="closeFAQModal()">&times;</span>
            </div>
            <form id="faqForm" onsubmit="saveFAQ(event)">
                <input type="hidden" id="faqId" value="">
                
                <div class="form-group">
                    <label for="faqQuestion">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° *</label>
                    <textarea id="faqQuestion" rows="3" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="faqAnswer">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö *</label>
                    <textarea id="faqAnswer" rows="5" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="faqCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label>
                    <input type="text" id="faqCategory" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£, ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°">
                </div>
                
                <div class="form-group">
                    <label for="faqKeywords">‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
                    <input type="text" id="faqKeywords" placeholder="‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç1, ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç2, ...">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeFAQModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Staff Modal -->
    <div id="staffModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h3>
                <span class="close-modal" onclick="closeStaffModal()">&times;</span>
            </div>
            <form id="staffForm" onsubmit="saveStaff(event)">
                <input type="hidden" id="staffId" value="">
                
                <div class="form-group">
                    <label for="staffNameTh">‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ *</label>
                    <input type="text" id="staffNameTh" required>
                </div>
                
                <div class="form-group">
                    <label for="staffNameEn">‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</label>
                    <input type="text" id="staffNameEn">
                </div>
                
                <div class="form-group">
                    <label for="staffDepartment">‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤ *</label>
                    <input type="text" id="staffDepartment" required>
                </div>
                
                <div class="form-group">
                    <label for="staffPosition">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="staffPosition">
                </div>
                
                <div class="form-group">
                    <label for="staffEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="staffEmail">
                </div>
                
                <div class="form-group">
                    <label for="staffPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="tel" id="staffPhone">
                </div>
                
                <div class="form-group">
                    <label for="staffRoom">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="staffRoom">
                </div>
                
                <div class="form-group">
                    <label for="staffOfficeHours">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</label>
                    <input type="text" id="staffOfficeHours">
                </div>
                
                <div class="form-group">
                    <label for="staffAvailability">‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</label>
                    <input type="text" id="staffAvailability">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeStaffModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="newsModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà</h3>
                <span class="close-modal" onclick="closeNewsModal()">&times;</span>
            </div>
            <form id="newsForm" onsubmit="saveNews(event)">
                <input type="hidden" id="newsId" value="">
                
                <div class="form-group">
                    <label for="newsTitle">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß *</label>
                    <input type="text" id="newsTitle" required placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß">
                </div>
                
                <div class="form-group">
                    <label for="newsContent">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ *</label>
                    <textarea id="newsContent" rows="6" required placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="newsSummary">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡πà‡∏≠</label>
                    <textarea id="newsSummary" rows="2" placeholder="‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏±‡πâ‡∏ô ‡πÜ (‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="newsCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label>
                    <select id="newsCategory" required>
                        <option value="‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                        <option value="‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newsPublishedDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</label>
                    <input type="date" id="newsPublishedDate">
                </div>
                
                <div class="form-group">
                    <label for="newsLinkUrl">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á</label>
                    <input type="url" id="newsLinkUrl" placeholder="https://...">
                </div>
                
                <div class="form-group">
                    <label for="newsThumbnailUrl">URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
                    <input type="url" id="newsThumbnailUrl" placeholder="https://...">
                </div>
                
                <div class="form-group">
                    <label for="newsTags">Tags (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
                    <input type="text" id="newsTags" placeholder="tag1, tag2, tag3">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeNewsModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // ==================== Helper Functions ====================
        
        function getToken() {
            const token = localStorage.getItem('admin_token');
            if (!token) {
                handleUnauthorized();
                return null;
            }
            return token;
        }
        
        function handleUnauthorized() {
            alert('Session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà');
            localStorage.removeItem('admin_token');
            window.location.href = 'login.html';
        }
        
        function showError(message) {
            console.error(message);
            alert(message);
        }
        
        function showSuccess(message) {
            console.log(message);
            alert(message);
        }
        
        // ==================== Authentication Check ====================
        
        // Check authentication on page load
        const token = localStorage.getItem('admin_token');
        if (!token) {
            window.location.href = 'login.html';
        }
        
        // ==================== Navigation ====================
        
        // Navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.content-section');
        const pageTitle = document.getElementById('pageTitle');
        
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                const sectionName = link.dataset.section;
                
                // Update active nav
                navLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                // Update active section
                sections.forEach(s => s.classList.remove('active'));
                document.getElementById(sectionName).classList.add('active');
                
                // Update page title
                const titles = {
                    'dashboard': 'Dashboard',
                    'faqs': 'FAQ Management',
                    'chatlogs': 'Chat Logs',
                    'news': 'News Management',
                    'staff': 'Staff Management'
                };
                pageTitle.textContent = titles[sectionName];
                
                // Load data for section
                if (sectionName === 'faqs') loadFAQs();
                else if (sectionName === 'chatlogs') loadChatLogs();
                else if (sectionName === 'news') loadNews();
                else if (sectionName === 'staff') loadStaff();
            });
        });
        
        // Load dashboard stats
        async function loadDashboardStats() {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'get_stats',
                        token: token
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to load stats');
                }
                
                // Update stats from API
                document.getElementById('totalFaqs').textContent = data.data.total_faqs || '0';
                document.getElementById('totalChats').textContent = data.data.total_chats || '0';
                document.getElementById('activeSessions').textContent = data.data.today_chats || '0';
                document.getElementById('avgResponse').textContent = 
                    (data.data.avg_confidence || 0).toFixed(2) + '%';
                
                // Load quick access stats
                loadQuickAccessStats();
                
                // Load recent chats
                loadRecentChats();
                
            } catch (error) {
                console.error('Error loading stats:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ: ' + error.message);
            }
        }
        
        async function loadQuickAccessStats() {
            // Load Feedback Stats
            try {
                const response = await fetch('../backend/analytics_api.php?action=feedback_stats');
                const data = await response.json();
                if (data.success) {
                    const positive = data.stats.find(s => s.feedback_type === 'positive') || {count: 0};
                    const negative = data.stats.find(s => s.feedback_type === 'negative') || {count: 0};
                    document.getElementById('feedbackQuickStats').textContent = 
                        `üëç ${positive.count} | üëé ${negative.count} (${data.total} total)`;
                }
            } catch (error) {
                document.getElementById('feedbackQuickStats').textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            }
            
            // Check AI Server Status
            try {
                const response = await fetch('http://localhost:5000/health');
                const data = await response.json();
                if (data.status === 'healthy') {
                    document.getElementById('aiServerStatus').innerHTML = 
                        '<span style="color: #10b981;">‚úÖ Online</span> - Model loaded';
                } else {
                    document.getElementById('aiServerStatus').innerHTML = 
                        '<span style="color: #f59e0b;">‚ö†Ô∏è Running</span> - Check model';
                }
            } catch (error) {
                document.getElementById('aiServerStatus').innerHTML = 
                    '<span style="color: #ef4444;">‚ùå Offline</span> - Server down';
            }
        }
        
        async function checkFeedbackStats() {
            window.open('analytics.html#feedback', '_blank');
        }
        
        async function checkAIStatus() {
            try {
                const response = await fetch('http://localhost:5000/health');
                const data = await response.json();
                alert(`AI Server Status\n\nStatus: ${data.status}\nModel Loaded: ${data.model_loaded ? 'Yes' : 'No'}\nTimestamp: ${new Date(data.timestamp).toLocaleString('th-TH')}`);
            } catch (error) {
                alert('AI Server Status\n\nStatus: Offline\nError: Cannot connect to server\n\nPlease start the server with:\npython ai/api/app.py');
            }
        }
        
        async function loadRecentChats() {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_chatlogs',
                        token: token,
                        limit: 5
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load recent chats');
                }
                
                const logs = data.data.logs || [];
                const tbody = document.getElementById('recentChats');
                
                if (logs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="loading">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</td></tr>';
                } else {
                    tbody.innerHTML = logs.map(log => {
                        const time = new Date(log.created_at);
                        const timeStr = time.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                        
                        // Convert confidence to percentage
                        const confidence = parseFloat(log.confidence || 0);
                        const confidencePercent = (confidence * 10).toFixed(2); // 9.9999 * 10 = 99.999%
                        const confidenceClass = confidence >= 7 ? 'badge-success' : 
                                               (confidence >= 3.5 ? 'badge-warning' : 'badge-danger');
                        
                        return `
                            <tr>
                                <td>${timeStr}</td>
                                <td>${log.user_message?.substring(0, 40) || '-'}${log.user_message?.length > 40 ? '...' : ''}</td>
                                <td><span class="badge ${confidenceClass}">${confidencePercent}%</span></td>
                                <td>${log.response_time_ms || '-'}ms</td>
                            </tr>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('Error loading recent chats:', error);
                const tbody = document.getElementById('recentChats');
                tbody.innerHTML = '<tr><td colspan="4" class="loading">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>';
            }
        }
        
        async function loadFAQs() {
            const token = getToken();
            if (!token) return;
            
            try {
                // Get search and filter values
                const searchTerm = document.getElementById('faqSearch')?.value || '';
                const categoryFilter = document.getElementById('categoryFilter')?.value || '';
                const currentPage = window.currentFaqPage || 1;
                const itemsPerPage = 20;
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_faqs',
                        token: token,
                        search: searchTerm,
                        category: categoryFilter,
                        page: currentPage,
                        limit: itemsPerPage
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to load FAQs');
                }
                
                const faqs = data.data.faqs || [];
                const totalPages = data.data.total_pages || 1;
                const totalItems = data.data.total || 0;
                
                // Render table
                const tbody = document.getElementById('faqList');
                if (faqs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="loading">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                } else {
                    tbody.innerHTML = faqs.map(faq => `
                        <tr>
                            <td>${faq.id}</td>
                            <td>${faq.question.substring(0, 60)}...</td>
                            <td>${faq.category}</td>
                            <td><span class="badge badge-${faq.is_active ? 'active' : 'inactive'}">${faq.is_active ? 'Active' : 'Inactive'}</span></td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-edit" onclick="editFAQ(${faq.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button class="btn-delete" onclick="deleteFAQ(${faq.id})">‡∏•‡∏ö</button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                }
                
                // Render pagination
                renderPagination(currentPage, totalPages, totalItems);
                
                // Populate category filter (first time only)
                if (!window.categoriesLoaded && data.data.categories) {
                    const select = document.getElementById('categoryFilter');
                    select.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>' + 
                        data.data.categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                    window.categoriesLoaded = true;
                }
                
            } catch (error) {
                console.error('Error loading FAQs:', error);
                document.getElementById('faqList').innerHTML = 
                    `<tr><td colspan="5" class="loading">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
            }
        }
        
        function renderPagination(currentPage, totalPages, totalItems) {
            const paginationDiv = document.getElementById('faqPagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let html = `<span class="page-info">‡πÅ‡∏™‡∏î‡∏á ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>`;
            
            // Previous button
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} 
                     onclick="changeFaqPage(${currentPage - 1})">¬´ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`;
            
            // Page numbers
            for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" 
                         onclick="changeFaqPage(${i})">${i}</button>`;
            }
            
            if (totalPages > 10) {
                html += `<span class="page-info">... ${totalPages}</span>`;
            }
            
            // Next button
            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                     onclick="changeFaqPage(${currentPage + 1})">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ¬ª</button>`;
            
            paginationDiv.innerHTML = html;
        }
        
        function changeFaqPage(page) {
            window.currentFaqPage = page;
            loadFAQs();
        }
        
        // Add event listeners for search and filter
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('faqSearch')?.addEventListener('input', () => {
                window.currentFaqPage = 1;
                loadFAQs();
            });
            
            document.getElementById('categoryFilter')?.addEventListener('change', () => {
                window.currentFaqPage = 1;
                loadFAQs();
            });
        });
        
        // ==================== FAQ CRUD Functions ====================
        
        function openCreateFAQModal() {
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏° FAQ ‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('faqForm').reset();
            document.getElementById('faqId').value = '';
            document.getElementById('faqModal').classList.add('show');
        }
        
        async function editFAQ(id) {
            const token = getToken();
            if (!token) return;
            
            try {
                // Fetch FAQ details
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_faqs',
                        token: token
                    })
                });
                
                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load FAQ');
                }
                
                const faq = data.data.faqs.find(f => f.id === id);
                if (!faq) {
                    throw new Error('FAQ not found');
                }
                
                // Populate form
                document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç FAQ';
                document.getElementById('faqId').value = faq.id;
                document.getElementById('faqQuestion').value = faq.question;
                document.getElementById('faqAnswer').value = faq.answer;
                document.getElementById('faqCategory').value = faq.category;
                document.getElementById('faqKeywords').value = faq.keywords || '';
                
                // Open modal
                document.getElementById('faqModal').classList.add('show');
                
            } catch (error) {
                console.error('Error loading FAQ:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• FAQ: ' + error.message);
            }
        }
        
        function closeFAQModal() {
            document.getElementById('faqModal').classList.remove('show');
            document.getElementById('faqForm').reset();
        }
        
        async function saveFAQ(event) {
            event.preventDefault();
            
            const token = getToken();
            if (!token) return;
            
            const id = document.getElementById('faqId').value;
            const question = document.getElementById('faqQuestion').value.trim();
            const answer = document.getElementById('faqAnswer').value.trim();
            const category = document.getElementById('faqCategory').value.trim();
            const keywords = document.getElementById('faqKeywords').value.trim();
            
            if (!question || !answer || !category) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            try {
                const action = id ? 'update_faq' : 'create_faq';
                const payload = {
                    action: action,
                    token: token,
                    data: {
                        question: question,
                        answer: answer,
                        category: category,
                        keywords: keywords
                    }
                };
                
                if (id) {
                    payload.id = parseInt(id);
                }
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to save FAQ');
                }
                
                showSuccess(id ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç FAQ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏° FAQ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                closeFAQModal();
                loadFAQs(); // Reload list
                loadDashboardStats(); // Update stats
                
            } catch (error) {
                console.error('Error saving FAQ:', error);
                showError('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å FAQ ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        function editFAQ_old(id) {
            // TODO: Implement edit modal/form
            showError('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç FAQ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤ (ID: ' + id + ')');
        }
        
        async function deleteFAQ(id) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö FAQ ‡∏ô‡∏µ‡πâ? (‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô soft delete)')) {
                return;
            }
            
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'delete_faq',
                        token: token,
                        id: id
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to delete FAQ');
                }
                
                showSuccess('‡∏•‡∏ö FAQ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                loadFAQs(); // Reload list
                loadDashboardStats(); // Update stats
                
            } catch (error) {
                console.error('Error deleting FAQ:', error);
                showError('‡∏•‡∏ö FAQ ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        // ==================== Chat Logs Functions ====================
        
        async function exportChatLogsCSV() {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_chatlogs',
                        token: token,
                        limit: 10000 // Export all
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load chat logs');
                }
                
                const logs = data.data.logs || [];
                
                if (logs.length === 0) {
                    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞ Export');
                    return;
                }
                
                // Create CSV content
                let csv = 'ÔªøSession ID,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤,‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°,‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö,Confidence (%),Response Time (ms)\n';
                
                logs.forEach(log => {
                    const sessionId = (log.session_id || '').replace(/,/g, ';');
                    const created = new Date(log.created_at).toLocaleString('th-TH');
                    const question = (log.user_message || '').replace(/,/g, ';').replace(/\n/g, ' ');
                    const answer = (log.bot_response || '').replace(/,/g, ';').replace(/\n/g, ' ');
                    const confidence = parseFloat(log.confidence || 0);
                    const confidencePercent = (confidence * 10).toFixed(2); // Convert to percentage
                    const responseTime = log.response_time_ms || '0';
                    
                    csv += `"${sessionId}","${created}","${question}","${answer}",${confidencePercent},${responseTime}\n`;
                });
                
                // Download CSV
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `chat_logs_${new Date().toISOString().slice(0,10)}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showSuccess(`Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (${logs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`);
                
            } catch (error) {
                console.error('Error exporting chat logs:', error);
                showError('Export ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        async function loadChatLogs() {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_chatlogs',
                        token: token,
                        limit: 50
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to load chat logs');
                }
                
                const logs = data.data.logs || [];
                const tbody = document.getElementById('chatLogsList');
                
                if (logs.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="loading">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                } else {
                    tbody.innerHTML = logs.map(log => {
                        // Convert confidence to percentage
                        const confidence = parseFloat(log.confidence || 0);
                        const confidencePercent = (confidence * 10).toFixed(2); // 9.9999 * 10 = 99.99%
                        const confidenceClass = confidence >= 7 ? 'badge-success' : 
                                               (confidence >= 3.5 ? 'badge-warning' : 'badge-danger');
                        
                        return `
                            <tr>
                                <td>${new Date(log.created_at).toLocaleString('th-TH')}</td>
                                <td>${log.user_message?.substring(0, 50) || '-'}...</td>
                                <td>${log.bot_response?.substring(0, 50) || '-'}...</td>
                                <td><span class="badge ${confidenceClass}">${confidencePercent}%</span></td>
                                <td>${log.response_time_ms || '-'}ms</td>
                            </tr>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('Error loading chat logs:', error);
                document.getElementById('chatLogsList').innerHTML = 
                    `<tr><td colspan="5" class="loading">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
            }
        }
        
        // ==================== Staff Management Functions ====================
        
        async function loadStaff() {
            const token = getToken();
            if (!token) return;
            
            try {
                const searchTerm = document.getElementById('staffSearch')?.value || '';
                const departmentFilter = document.getElementById('departmentFilter')?.value || '';
                const currentPage = window.currentStaffPage || 1;
                const itemsPerPage = 20;
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_staff',
                        token: token,
                        search: searchTerm,
                        department: departmentFilter,
                        page: currentPage,
                        limit: itemsPerPage
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to load staff');
                }
                
                const staff = data.data.staff || [];
                const totalPages = data.data.total_pages || 1;
                const totalItems = data.data.total || 0;
                
                const tbody = document.getElementById('staffList');
                if (staff.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="loading">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                } else {
                    tbody.innerHTML = staff.map(s => `
                        <tr>
                            <td>${s.id}</td>
                            <td>${s.name_th}</td>
                            <td>${s.department}</td>
                            <td>${s.position || '-'}</td>
                            <td>${s.email || '-'}</td>
                            <td>${s.phone || '-'}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-edit" onclick="editStaff(${s.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                }
                
                // Render pagination
                renderStaffPagination(currentPage, totalPages, totalItems);
                
                // Populate department filter
                if (!window.departmentsLoaded && data.data.departments) {
                    const select = document.getElementById('departmentFilter');
                    select.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤</option>' + 
                        data.data.departments.map(dept => `<option value="${dept}">${dept}</option>`).join('');
                    window.departmentsLoaded = true;
                }
                
            } catch (error) {
                console.error('Error loading staff:', error);
                document.getElementById('staffList').innerHTML = 
                    `<tr><td colspan="7" class="loading">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
            }
        }
        
        function renderStaffPagination(currentPage, totalPages, totalItems) {
            const paginationDiv = document.getElementById('staffPagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let html = `<span class="page-info">‡πÅ‡∏™‡∏î‡∏á ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>`;
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} 
                     onclick="changeStaffPage(${currentPage - 1})">¬´ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`;
            
            for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" 
                         onclick="changeStaffPage(${i})">${i}</button>`;
            }
            
            if (totalPages > 10) {
                html += `<span class="page-info">... ${totalPages}</span>`;
            }
            
            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                     onclick="changeStaffPage(${currentPage + 1})">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ¬ª</button>`;
            
            paginationDiv.innerHTML = html;
        }
        
        function changeStaffPage(page) {
            window.currentStaffPage = page;
            loadStaff();
        }
        
        async function editStaff(id) {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_staff',
                        token: token
                    })
                });
                
                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load staff');
                }
                
                const staff = data.data.staff.find(s => s.id === id);
                if (!staff) {
                    throw new Error('Staff not found');
                }
                
                // Populate form
                document.getElementById('staffId').value = staff.id;
                document.getElementById('staffNameTh').value = staff.name_th || '';
                document.getElementById('staffNameEn').value = staff.name_en || '';
                document.getElementById('staffDepartment').value = staff.department || '';
                document.getElementById('staffPosition').value = staff.position || '';
                document.getElementById('staffEmail').value = staff.email || '';
                document.getElementById('staffPhone').value = staff.phone || '';
                document.getElementById('staffRoom').value = staff.room || '';
                document.getElementById('staffOfficeHours').value = staff.office_hours || '';
                document.getElementById('staffAvailability').value = staff.availability || '';
                
                // Open modal
                document.getElementById('staffModal').classList.add('show');
                
            } catch (error) {
                console.error('Error loading staff:', error);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£: ' + error.message);
            }
        }
        
        function closeStaffModal() {
            document.getElementById('staffModal').classList.remove('show');
            document.getElementById('staffForm').reset();
        }
        
        async function saveStaff(event) {
            event.preventDefault();
            
            const token = getToken();
            if (!token) return;
            
            const id = document.getElementById('staffId').value;
            
            if (!id) {
                showError('‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£');
                return;
            }
            
            try {
                const payload = {
                    action: 'update_staff',
                    token: token,
                    id: parseInt(id),
                    data: {
                        name_th: document.getElementById('staffNameTh').value.trim(),
                        name_en: document.getElementById('staffNameEn').value.trim(),
                        department: document.getElementById('staffDepartment').value.trim(),
                        position: document.getElementById('staffPosition').value.trim(),
                        email: document.getElementById('staffEmail').value.trim(),
                        phone: document.getElementById('staffPhone').value.trim(),
                        room: document.getElementById('staffRoom').value.trim(),
                        office_hours: document.getElementById('staffOfficeHours').value.trim(),
                        availability: document.getElementById('staffAvailability').value.trim()
                    }
                };
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to update staff');
                }
                
                showSuccess('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                closeStaffModal();
                loadStaff();
                
            } catch (error) {
                console.error('Error saving staff:', error);
                showError('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        // Add event listeners for staff search/filter
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('staffSearch')?.addEventListener('input', () => {
                window.currentStaffPage = 1;
                loadStaff();
            });
            
            document.getElementById('departmentFilter')?.addEventListener('change', () => {
                window.currentStaffPage = 1;
                loadStaff();
            });
        });
        
        // ==================== News Management Functions ====================
        
        async function loadNews() {
            const token = getToken();
            if (!token) return;
            
            try {
                const searchTerm = document.getElementById('newsSearch')?.value || '';
                const categoryFilter = document.getElementById('newsCategoryFilter')?.value || '';
                const currentPage = window.currentNewsPage || 1;
                const itemsPerPage = 20;
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_news',
                        token: token,
                        search: searchTerm,
                        category: categoryFilter,
                        page: currentPage,
                        limit: itemsPerPage
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to load news');
                }
                
                const news = data.data.news || [];
                const totalPages = data.data.total_pages || 1;
                const totalItems = data.data.total || 0;
                
                const tbody = document.getElementById('newsList');
                if (news.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="loading">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                } else {
                    tbody.innerHTML = news.map(item => {
                        const publishedDate = item.published_date ? 
                            new Date(item.published_date).toLocaleDateString('th-TH') : '-';
                        const statusClass = item.is_active == 1 ? 'badge-active' : 'badge-inactive';
                        const statusText = item.is_active == 1 ? '‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà' : '‡πÑ‡∏°‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà';
                        
                        return `
                            <tr>
                                <td>${item.id}</td>
                                <td style="max-width: 300px;">${item.title || '-'}</td>
                                <td><span class="badge badge-info">${item.category || '-'}</span></td>
                                <td>${publishedDate}</td>
                                <td>${item.view_count || 0}</td>
                                <td><span class="badge ${statusClass}">${statusText}</span></td>
                                <td>
                                    <div class="action-btns">
                                        <button class="btn-edit" onclick="editNews(${item.id})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                        <button class="btn-delete" onclick="deleteNews(${item.id})">‡∏•‡∏ö</button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                renderNewsPagination(currentPage, totalPages, totalItems);
                
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('newsList').innerHTML = 
                    `<tr><td colspan="7" class="loading">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
            }
        }
        
        function renderNewsPagination(currentPage, totalPages, totalItems) {
            const paginationDiv = document.getElementById('newsPagination');
            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }
            
            let html = `<span class="page-info">‡πÅ‡∏™‡∏î‡∏á ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>`;
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} 
                     onclick="changeNewsPage(${currentPage - 1})">¬´ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`;
            
            for (let i = 1; i <= Math.min(totalPages, 10); i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" 
                         onclick="changeNewsPage(${i})">${i}</button>`;
            }
            
            if (totalPages > 10) {
                html += `<span class="page-info">... ${totalPages}</span>`;
            }
            
            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} 
                     onclick="changeNewsPage(${currentPage + 1})">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ¬ª</button>`;
            
            paginationDiv.innerHTML = html;
        }
        
        function changeNewsPage(page) {
            window.currentNewsPage = page;
            loadNews();
        }
        
        function openCreateNewsModal() {
            document.getElementById('newsModalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('newsId').value = '';
            document.getElementById('newsForm').reset();
            document.getElementById('newsPublishedDate').valueAsDate = new Date();
            document.getElementById('newsModal').classList.add('show');
        }
        
        async function editNews(id) {
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'list_news',
                        token: token
                    })
                });
                
                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load news');
                }
                
                const newsItem = data.data.news.find(n => n.id == id);
                if (!newsItem) {
                    throw new Error('News not found');
                }
                
                // Populate form
                document.getElementById('newsModalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß';
                document.getElementById('newsId').value = newsItem.id;
                document.getElementById('newsTitle').value = newsItem.title || '';
                document.getElementById('newsContent').value = newsItem.content || '';
                document.getElementById('newsSummary').value = newsItem.summary || '';
                document.getElementById('newsCategory').value = newsItem.category || '';
                document.getElementById('newsPublishedDate').value = newsItem.published_date || '';
                document.getElementById('newsLinkUrl').value = newsItem.link_url || '';
                document.getElementById('newsThumbnailUrl').value = newsItem.thumbnail_url || '';
                document.getElementById('newsTags').value = newsItem.tags || '';
                
                document.getElementById('newsModal').classList.add('show');
                
            } catch (error) {
                console.error('Error loading news:', error);
                showError('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        function closeNewsModal() {
            document.getElementById('newsModal').classList.remove('show');
        }
        
        async function saveNews(event) {
            event.preventDefault();
            
            const token = getToken();
            if (!token) return;
            
            const id = document.getElementById('newsId').value;
            const title = document.getElementById('newsTitle').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            
            if (!title || !content) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            try {
                const action = id ? 'update_news' : 'create_news';
                const payload = {
                    action: action,
                    token: token,
                    data: {
                        title: title,
                        content: content,
                        summary: document.getElementById('newsSummary').value.trim(),
                        category: document.getElementById('newsCategory').value,
                        published_date: document.getElementById('newsPublishedDate').value,
                        link_url: document.getElementById('newsLinkUrl').value.trim(),
                        thumbnail_url: document.getElementById('newsThumbnailUrl').value.trim(),
                        tags: document.getElementById('newsTags').value.trim(),
                        is_active: 1
                    }
                };
                
                if (id) {
                    payload.id = parseInt(id);
                }
                
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to save news');
                }
                
                showSuccess(id ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                closeNewsModal();
                loadNews();
                
            } catch (error) {
                console.error('Error saving news:', error);
                showError('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        async function deleteNews(id) {
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                return;
            }
            
            const token = getToken();
            if (!token) return;
            
            try {
                const response = await fetch('../backend/admin_api.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'delete_news',
                        token: token,
                        id: id
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (response.status === 401) {
                        handleUnauthorized();
                    }
                    throw new Error(data.error || 'Failed to delete news');
                }
                
                showSuccess('‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                loadNews();
                
            } catch (error) {
                console.error('Error deleting news:', error);
                showError('‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        async function scrapeNews() {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n(‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)')) {
                return;
            }
            
            showSuccess('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß... (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ 10-30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)');
            
            try {
                const response = await fetch('../scripts/scrape_news.php', {
                    method: 'GET'
                });
                
                const text = await response.text();
                console.log('Scrape result:', text);
                
                // Reload news after scraping
                setTimeout(() => {
                    loadNews();
                    showSuccess('‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà');
                }, 2000);
                
            } catch (error) {
                console.error('Error scraping news:', error);
                showError('‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message);
            }
        }
        
        // Add event listeners for news search/filter
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('newsSearch')?.addEventListener('input', () => {
                window.currentNewsPage = 1;
                loadNews();
            });
            
            document.getElementById('newsCategoryFilter')?.addEventListener('change', () => {
                window.currentNewsPage = 1;
                loadNews();
            });
        });
        
        // ==================== Logout ====================
        
        function logout() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
                const token = getToken();
                
                // Call logout API (optional - for tracking)
                if (token) {
                    fetch('../backend/admin_login.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            action: 'logout',
                            token: token
                        })
                    }).catch(err => console.error('Logout API error:', err));
                }
                
                localStorage.removeItem('admin_token');
                window.location.href = 'login.html';
            }
        }
        
        // ==================== Initialize ====================
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const faqModal = document.getElementById('faqModal');
            const staffModal = document.getElementById('staffModal');
            
            if (event.target === faqModal) {
                closeFAQModal();
            } else if (event.target === staffModal) {
                closeStaffModal();
            }
        };
        
        // Load initial data
        loadDashboardStats();
    </script>
</body>
</html>
